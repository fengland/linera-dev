## 概述

Linera是一个去中心化的Web3基础设施，针对高并发访问的Web3应用进行优化。当海量活跃用户并发访问Linera上的Web3应用，Linera可以保障应用服务能力不降级。

Linera协议的核心在于使用同一组验证器并发运行大量称为**微链**的轻量级区块链。

## [工作机制](https://linera-dev.respeer.ai/#/zh_CN/core_concepts/overview?id=how-does-it-work)

在Linera中，用户钱包操作自己的微链，微链所有者决定何时创建新区块，以及区块中包含什么内容。如果微链只包含所有者一个用户，我们将这样的微链称为**用户链**。

微链的所有者创建和执行区块以处理下列事件：
- 处理从其他微链发送给本链**消息**
- 执行用户账户安全**操作**，例如给另一个用户(译者注：通常在另一条微链上)转账

需要指出的是，验证器确保所有新区块都**有效**。例如，转账操作应该来自余额足够的账户；收到的消息却是从另一条微链发出。验证器使用同样的方法验证每一条微链的区块。

Linera**应用**是一个定义了自己的状态和操作的Wasm程序。用户可以在一条微链上发布字节码创建并初始化应用。如果该应用在其他微链(译者注：并非发布应用的微链)被调用，应用将会被自动部署到其他微链。每个应用在每条微链上拥有独立的状态存储。

应用依赖于异步**跨链消息**确保不同微链上的应用实例跨链协作。异步消息的载荷部分(payload)在应用内部解析，系统其余部分不需要感知消息载荷。

```ignore
                               ┌───┐     ┌───┐     ┌───┐
                       Chain A │   ├────►│   ├────►│   │
                               └───┘     └───┘     └───┘
                                                     ▲
                                           ┌─────────┘
                                           │
                               ┌───┐     ┌─┴─┐     ┌───┐
                       Chain B │   ├────►│   ├────►│   │
                               └───┘     └─┬─┘     └───┘
                                           │         ▲
                                           │         │
                                           ▼         │
                               ┌───┐     ┌───┐     ┌─┴─┐
                       Chain C │   ├────►│   ├────►│   │
                               └───┘     └───┘     └───┘
```

单条微链上的应用数量可以是无限的。同一条微链上的应用实例之间通过异步调用**组合**。

最新的Linera SDK基于Rust进行开发，其上的应用也需要通过使用Rust编程语言，然后编译成Wasm应用。Rust程序员可以使用通用的Rust工具链和他们最喜欢的开发环境开发Linera应用。

## [Linera和其他多链架构的比较](https://linera-dev.respeer.ai/#/zh_CN/core_concepts/overview?id=how-does-linera-compare-to-existing-multi-chain-infrastructure)

Linera是第一个设计支持并行执行多链的架构，尤其是通过用户钱包操作任意数量的**用户链**。

传统多链架构中，每一条平行链由一组验证器执行，其中包含一个完整的区块链协议。这样的架构创建新的平行链或者在平行链之间交换消息成本高昂，因而平行链的数量通常是有限的。很多平行链只能处理特定场景，这样的链也被称为`应用链`。

相比之下，Linera是为了并行运行大量的用户链设计和优化的：

- 用户仅在需要的时候在自己的微链创建新区块；
- 创建新的微链不需要添加验证器；
- 所有微链具有相同安全级别；
- 微链之间通过验证器内部网络高效通信；
- 验证器像常规Web服务一样内部分片，因此可以通过增加或减少工作节点弹性调整验证器能力。

> 除了用户链，[Linera协议](https://linera.io/whitepaper)也支持其他类型微链，称为`许可链`和`公开链`。公开链和经典区块链一样，由验证器操作(译者注：即由验证器创建新区块，这里验证器就是矿工)。许可链通常用于用户之间的临时交互，比如原子交换。

## [为什么要在Linera上开发?](https://linera-dev.respeer.ai/#/zh_CN/core_concepts/overview?id=why-build-on-top-of-linera)

我们认为，当前的Web3基础设施服务于**海量活跃用户**并发访问的场景时，不能保证同等服务质量(不可预测的手续费，延迟等)，导致很多高价值的应用场景不能实施。

如下的应用场景中，海量用户将会创建大量交易，这些交易需要在规定时间内完成处理：

- 实时微支付和微奖励，
- 社交数据流，
- 实时拍卖系统，
- 回合制游戏，
- 软件、数据流水线或者AI训练流水线的版本控制系统。

除了提供弹性扩展能力，轻量级用户链还给系统带来了其他好处。相比传统区块链，Linera的轻量级用户链的区块少得多，因此可以将用户链的全节点(译者注：此处指维护用户所拥有的微链的服务)嵌入到用户钱包，这些钱包通常以浏览器插件的方式部署。

这样的实现意味着连接到钱包的Web应用界面可以通过成熟的前端框架(React/GraphQL)直接(不需要对接API提供商，不需要轻客户端)查询用户链状态。此外，钱包可以以多种方式，例如向用户展示有意义的消息确认信息，增强全节点的安全性。

## [Linera开发状态](https://linera-dev.respeer.ai/#/zh_CN/core_concepts/overview?id=what-is-the-current-state-of-the-development-of-linera)

Linera协议的[开源参考实现](https://github.com/linera-io/linera-protocol)当前正在积极开发中。参考实现中提供封装好的Web3 SDK，其中包含构建简单的Web3应用所需的必要功能，当前实现支持开发者在一台机器上的本地网络测试他们的应用。值得指出的是，开发者已经可以基于内嵌的Wasm GraphQL服务构建(可能是响应式的)Web应用界面，并通过浏览器执行测试。

当前版本Web3 SDK有下面的已知限制：

- Web用户界面需要请求作为钱包的本地HTTP服务。该服务是临时的，且仅作为测试用途。将来的版本中，与其他区块链相同，Web用户界面将会通过安全通道连接到浏览器钱包插件。
- 本文档撰写时，Linera SDK仅能支持用户链，其他类型的微链(称为“公开链”和“许可链”)将在未来支持。

Linera的开发工作流可以拆分如下，其中包含除了SDK之外的其他开发工作：

### [核心协议](https://linera-dev.respeer.ai/#/zh_CN/core_concepts/overview?id=core-protocol)

- [x] 用户链
- [x] 权限链（仅核心协议）
- [x] 跨链消息
- [x] 跨链发布/订阅通道（初始版本）
- [x] 字节码发布
- [x] 应用程序创建
- [x] 验证者重新配置
- [x] 支持 gas 费用
- [x] 支持存储费用和存储限制
- [x] 外部服务（称为“水龙头”）帮助用户创建其第一条链
- [x] 权限链（添加操作访问控制、原子交换演示等）
- [ ] 避免重复从存储加载链状态
- [ ] 可供系统和用户应用程序使用的 Blob 存储（泛化/替换字节码存储）
- [ ] 支持将用户链轻松引入新应用程序（去除接受请求的需求）
- [ ] 替换发布/订阅通道为数据流（去除接受订阅的需求）
- [ ] 允许链客户端控制其跟踪（惰性/主动）和执行（不执行所有跟踪的链）
- [ ] 多签名事件以便未来与外部链的桥接
- [ ] 公共链（添加领导选举、收件箱约束等）
- [ ] 交易脚本
- [ ] 支持动态分片分配
- [ ] 支持归档链
- [ ] 所有利益相关者的 Tokenomics 和激励
- [ ] 在管理链上的治理（例如 DPoS、验证者入职）
- [ ] 无需许可的审计协议

### [集成Wasm虚拟机](https://linera-dev.respeer.ai/#/zh_CN/core_concepts/overview?id=wasm-vm-integration)

- [x] 支持 Wasmer VM
- [x] 支持 Wasmtime VM（实验性）
- [x] 测试虚拟机间的 gas 计量和确定性执行
- [x] 在同一链上组合 Wasm 应用程序
- [x] 支持非阻塞（但确定性）的对存储的调用
- [x] 支持在 Wasm 中的只读 GraphQL 服务
- [x] 支持模拟系统 API
- [x] 改进主机/客户桩生成，以使模拟更容易
- [ ] 支持在浏览器中运行 Wasm 应用程序

### [存储](https://linera-dev.respeer.ai/#/zh_CN/core_concepts/overview?id=storage)

- [x] 基于键值存储抽象的对象管理库（“linera-views”）
- [x] 支持 Rocksdb
- [x] 实验性支持 DynamoDb
- [x] 为 GraphQL 派生宏
- [x] 支持 ScyllaDb
- [x] 使库对用户完全可扩展（需要更好的 GraphQL 宏）
- [x] 用于测试目的的内存存储服务
- [x] 支持 Web 存储（IndexedDB）
- [ ] 性能基准和改进（包括更快的状态哈希）
- [ ] 更好的配置管理
- [ ] 本地写前日志
- [ ] 选定主数据库的生产级支持
- [ ] 调试工具
- [ ] 使存储库在 Linera 之外易于使用

### [验证器基础设施](https://linera-dev.respeer.ai/#/zh_CN/core_concepts/overview?id=validator-infrastructure)

- [x] 简单的 TCP/UDP 网络（仅用于基准测试）
- [x] GRPC 网络
- [x] 支持固定内部分片的基本前端（称为代理）
- [x] 可观察性
- [x] CI 中的 Kubernetes 支持
- [x] 使用云提供商部署
- [ ] 水平可扩展的前端（称为代理）
- [ ] 动态分片分配
- [ ] 云集成以演示弹性扩展

### [Web3 SDK](https://linera-dev.respeer.ai/#/zh_CN/core_concepts/overview?id=web3-sdk)

- [x] 合同和服务接口的特性
- [x] 支持单元测试
- [x] 支持集成测试
- [x] 本地 GraphQL 服务以查询和浏览系统状态
- [x] 本地 GraphQL 服务以查询和浏览应用程序状态
- [x] 使用 GraphQL mutations 执行操作和创建区块
- [x] 合同和服务接口的 ABI
- [x] 允许消息发送者支付消息执行费用
- [ ] 钱包作为浏览器扩展（无 VM）
- [ ] 钱包作为浏览器扩展（带 Wasm VM）
- [ ] 更容易与 EVM 链通信
- [ ] 绑定以使用 Wasm 的原生加密原语
- [ ] 允许应用程序支付用户费用
- [ ] 允许应用程序使用权限链和公共链
